<!DOCTYPE html>
<html layout:decorate="~{_layouts/default_layout}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>마이페이지 - 내 정보 관리</title>
    <style>
        .profile-info-grid-kitsch {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem 1.5rem;
        }

        .profile-info-grid-kitsch .form-group-kitsch {
            margin-bottom: 0.5rem;
        }


        .password-change-note-kitsch {
            font-family: var(--font-pixel);
            font-size: 0.8rem;
            color: var(--kitsch-color-5);
            margin-top: 0.5rem;
            padding: 0.5rem;
            background-color: rgba(17, 158, 194, 0.1);
            border: 1px dashed var(--kitsch-color-4);
            border-radius: 3px;
        }
    </style>
</head>

<body>
<div layout:fragment="content">
    <div class="container-kitsch section-padding-kitsch">

        <div class="mypage-header-kitsch">
            <h1 class="page-main-title-kitsch display-font-kitsch"><i class="fas fa-user-cog"></i> 마이페이지 <i
                    class="fas fa-star"></i></h1>
            <div class="mypage-user-summary-kitsch">
                <span>회원등급: <strong class="highlight-yellow-kitsch">골드</strong></span> |
                <span>포인트: <strong class="highlight-yellow-kitsch">3,500 P</strong></span> |
                <span>사용가능 쿠폰: <strong class="highlight-yellow-kitsch">5 장</strong></span>
            </div>
        </div>

        <div class="mypage-layout-kitsch">
            <div th:replace="~{_fragments/mypage_sidebar :: mypageSidebarFragment(activeMenu='profile')}"></div>


            <main class="mypage-content-kitsch">
                <section class="mypage-section-kitsch" id="profileInfoSection">
                    <h3 class="section-title-kitsch"><i class="fas fa-user-edit"></i> 기본 정보 수정</h3>
                    <form action="/mypage/profile/update" id="profileForm" method="post">
                        <div class="profile-info-grid-kitsch">
                            <div class="form-group-kitsch">
                                <label class="label-kitsch handwriting-font-kitsch" for="profileName">이름:</label>
                                <input class="input-kitsch pixel-font-kitsch" id="profileName" name="name" readonly
                                       type="text" value="겜돌이_77">
                            </div>
                            <div class="form-group-kitsch">
                                <label class="label-kitsch handwriting-font-kitsch" for="profileMemberId">아이디:</label>
                                <input class="input-kitsch pixel-font-kitsch" id="profileMemberId" name="memberId"
                                       readonly type="text" value="gamer77">
                            </div>
                            <div class="form-group-kitsch">
                                <label class="label-kitsch handwriting-font-kitsch" for="profileEmail">이메일:</label>
                                <input class="input-kitsch pixel-font-kitsch" id="profileEmail" name="email"
                                       required type="email" value="gamer77@bluebooktle.com">
                            </div>
                            <div class="form-group-kitsch">
                                <label class="label-kitsch handwriting-font-kitsch" for="profilePhone">연락처:</label>
                                <input class="input-kitsch pixel-font-kitsch" id="profilePhone" name="phoneNumber"
                                       required type="tel" value="010-1234-5678">
                            </div>
                            <div class="form-group-kitsch">
                                <label class="label-kitsch handwriting-font-kitsch" for="profileBirthDate">생년월일:</label>
                                <input class="input-kitsch pixel-font-kitsch" id="profileBirthDate" name="birthDate"
                                       type="date" value="1988-05-15">
                            </div>
                            <div class="form-group-kitsch">
                                <label class="label-kitsch handwriting-font-kitsch">가입일:</label>
                                <input class="input-kitsch pixel-font-kitsch" readonly type="text" value="2023-01-15">
                            </div>
                        </div>
                        <div class="mypage-actions-kitsch">
                            <button class="btn-kitsch primary-btn-kitsch retro-shadow-kitsch" type="submit">
                                <i class="fas fa-save"></i> 정보 저장
                            </button>
                        </div>
                    </form>
                </section>

                <section class="mypage-section-kitsch" id="passwordChangeSection">
                    <h3 class="section-title-kitsch"><i class="fas fa-key"></i> 비밀번호 변경</h3>
                    <form action="/mypage/password/update" id="passwordChangeForm" method="post">
                        <div class="form-group-kitsch">
                            <label class="label-kitsch handwriting-font-kitsch" for="currentPassword">현재 비밀번호:</label>
                            <input class="input-kitsch pixel-font-kitsch" id="currentPassword" name="currentPassword"
                                   required type="password">
                        </div>
                        <div class="form-group-kitsch">
                            <label class="label-kitsch handwriting-font-kitsch" for="newPassword">새 비밀번호:</label>
                            <input class="input-kitsch pixel-font-kitsch" id="newPassword" name="newPassword"
                                   required type="password">
                            <p class="password-change-note-kitsch">
                                <i class="fas fa-info-circle"></i> 영문, 숫자, 특수문자 포함 8자 이상으로 만들어주세요!
                            </p>
                        </div>
                        <div class="form-group-kitsch">
                            <label class="label-kitsch handwriting-font-kitsch" for="confirmNewPassword">새 비밀번호
                                확인:</label>
                            <input class="input-kitsch pixel-font-kitsch" id="confirmNewPassword"
                                   name="confirmNewPassword"
                                   required type="password">
                        </div>
                        <div class="mypage-actions-kitsch">
                            <button class="btn-kitsch secondary-btn-kitsch color3-kitsch retro-shadow-kitsch"
                                    type="submit">
                                <i class="fas fa-exchange-alt"></i> 비밀번호 변경
                            </button>
                        </div>
                    </form>
                </section>
            </main>
        </div>
    </div>
</div>

<th:block layout:fragment="page_scripts">
    <script>
        document.getElementById('profileForm')?.addEventListener('submit', function (e) {
            e.preventDefault();
            alert('프로필 정보가 저장되었습니다! (Mock)');
        });

        document.getElementById('passwordChangeForm')?.addEventListener('submit', function (e) {
            e.preventDefault();
            const newPassword = document.getElementById('newPassword').value;
            const confirmNewPassword = document.getElementById('confirmNewPassword').value;
            if (newPassword !== confirmNewPassword) {
                alert('새 비밀번호와 확인 비밀번호가 일치하지 않습니다. (Mock)');
                return false;
            }
            alert('비밀번호가 성공적으로 변경되었습니다! (Mock)');
            this.reset();
        });

        document.addEventListener('DOMContentLoaded', function () {
            const currentPath = window.location.pathname;
            const sidebarLinks = document.querySelectorAll('.mypage-sidebar-kitsch .sidebar-menu-kitsch li a');
            sidebarLinks.forEach(link => {
                link.classList.remove('active'); // 일단 모두 비활성화
                if (link.getAttribute('href') === currentPath) {
                    link.classList.add('active');
                }
            });
            if (currentPath === '/mypage' || currentPath === '/mypage/') {
                const profileLink = document.querySelector('.mypage-sidebar-kitsch .sidebar-menu-kitsch li a[href$="/mypage/profile"]');
                if (profileLink) profileLink.classList.add('active');
            }
        });
    </script>
</th:block>
</body>
</html>