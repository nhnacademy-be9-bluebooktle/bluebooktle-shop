<!DOCTYPE html>
<html layout:decorate="~{_layouts/default_layout}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org">

<head>
    <title>회원가입</title>
    <style>
        .signup-form-container-kitsch {
            max-width: 650px;
            margin: 3rem auto;
            padding: 2.5rem;
            background-color: var(--kitsch-bg-alt);
            border: 3px solid var(--kitsch-text-dark);
            border-radius: 10px;
            box-shadow: 5px 5px 0px var(--kitsch-color-3);
        }

        .signup-form-container-kitsch .form-title-kitsch {
            font-family: var(--font-display);
            font-size: 2.2rem;
            color: var(--kitsch-color-5);
            text-align: center;
            margin-bottom: 2rem;
        }

        .form-group-kitsch {
            margin-bottom: 1.2rem;
        }

        .form-group-kitsch .label-kitsch {
            display: block;
            margin-bottom: 0.4rem;
            color: var(--kitsch-color-1);
            font-family: var(--font-handwriting);
            font-size: 1.15em;
        }

        .form-group-kitsch .input-kitsch {
            margin-bottom: 0.2rem;
        }

        .input-kitsch.error-kitsch {
            border: 2px solid var(--kitsch-color-3);
        }

        .input-description-kitsch {
            font-family: var(--font-pixel);
            font-size: 0.75rem;
            color: var(--kitsch-text-dark);
            opacity: 0.8;
        }

        .address-group-kitsch {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .address-group-kitsch .input-kitsch {
            flex-grow: 1;
        }

        .address-group-kitsch .small-btn-kitsch {
            white-space: nowrap;
        }

        .terms-agreement-kitsch {
            margin-top: 2rem;
            padding: 1.5rem;
            border: 2px dashed var(--kitsch-color-2);
            border-radius: 5px;
            background-color: rgba(255, 255, 255, 0.4);
        }

        .terms-agreement-kitsch .checkbox-kitsch {
            margin-bottom: 0.8rem;
            font-family: var(--font-pixel);
            font-size: 0.9rem;
        }

        .terms-agreement-kitsch .checkbox-kitsch label {
            display: flex;
            align-items: center;
        }

        .terms-agreement-kitsch .checkbox-custom-kitsch {
            margin-top: -2px;
        }

        .terms-link-kitsch {
            color: var(--kitsch-color-4);
            text-decoration: underline dotted;
            font-weight: bold;
        }

        .terms-link-kitsch:hover {
            color: var(--kitsch-color-3);
        }

        .field-error {
            font-family: var(--font-pixel);
            color: var(--kitsch-color-3);
            font-size: 0.8rem;
            margin-top: 0.2rem;
            display: block;
        }

        .global-error-message {
            color: red;
            background-color: #ffebee;
            border: 1px solid red;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 4px;
            text-align: center;
        }
    </style>
</head>

<body>
<div layout:fragment="content">
    <div class="container-kitsch">
        <div class="signup-form-container-kitsch">
            <h2 class="form-title-kitsch display-font-kitsch"><i class="fas fa-ghost"></i> 회원가입 <i
                    class="fas fa-heart"></i></h2>

            <div th:if="${error}" class="global-error-message">
                <strong class="error-kitsch pixel-font-kitsch"
                        th:text="${errorCode != null ? errorCode + ': ' : ''}"></strong>
                <span th:text="${errorMessage != null ? errorMessage : '알 수 없는 오류가 발생했습니다.'}"></span>
            </div>

            <form th:action="@{/signup}" method="post" th:object="${signupRequest}">
                <div class="form-group-kitsch">
                    <label class="label-kitsch handwriting-font-kitsch" for="name">이름<span
                            class="required-star">*</span></label>
                    <input class="input-kitsch pixel-font-kitsch" id="name" type="text" th:field="*{name}"
                           placeholder="실명을 입력해주세요" required
                           th:errorclass="error-kitsch"/>
                    <span class="field-error" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></span>
                </div>

                <div class="form-group-kitsch">
                    <label class="label-kitsch handwriting-font-kitsch" for="loginId">아이디<span
                            class="required-star">*</span></label>
                    <input class="input-kitsch pixel-font-kitsch" id="loginId" type="text" th:field="*{loginId}"
                           placeholder="영문, 숫자 조합 4~20자" required minlength="4" maxlength="20"
                           th:errorclass="error-kitsch"/>
                    <span class="field-error" th:if="${#fields.hasErrors('loginId')}" th:errors="*{loginId}"></span>
                </div>

                <div class="form-group-kitsch">
                    <label class="label-kitsch handwriting-font-kitsch" for="password">비밀번호<span
                            class="required-star">*</span></label>
                    <input class="input-kitsch pixel-font-kitsch" id="password" type="password" th:field="*{password}"
                           placeholder="8자 이상 입력해주세요" required
                           th:errorclass="error-kitsch"/>
                    <span class="field-error" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></span>
                </div>

                <div class="form-group-kitsch">
                    <label class="label-kitsch handwriting-font-kitsch" for="passwordConfirm">비밀번호 확인<span
                            class="required-star">*</span></label>
                    <input class="input-kitsch pixel-font-kitsch" id="passwordConfirm" name="passwordConfirm"
                           type="password" placeholder="비밀번호를 다시 입력해주세요" required/>
                </div>

                <div class="form-group-kitsch">
                    <label class="label-kitsch handwriting-font-kitsch" for="email">이메일<span
                            class="required-star">*</span></label>
                    <input class="input-kitsch pixel-font-kitsch" id="email" type="email" th:field="*{email}"
                           placeholder="예: blue@booktle.com" required
                           th:errorclass="error-kitsch"/>
                    <span class="field-error" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></span>
                </div>

                <div class="form-group-kitsch">
                    <label class="label-kitsch handwriting-font-kitsch" for="nickname">닉네임<span
                            class="required-star">*</span></label>
                    <input class="input-kitsch pixel-font-kitsch" id="nickname" type="text" th:field="*{nickname}"
                           placeholder="닉네임을 입력해주세요 (20자 이하)" required maxlength="20"
                           th:errorclass="error-kitsch"/>
                    <span class="field-error" th:if="${#fields.hasErrors('nickname')}" th:errors="*{nickname}"></span>
                </div>

                <div class="form-group-kitsch">
                    <label class="label-kitsch handwriting-font-kitsch" for="phoneNumber">연락처<span
                            class="required-star">*</span></label>
                    <input class="input-kitsch pixel-font-kitsch" id="phoneNumber" type="tel" th:field="*{phoneNumber}"
                           placeholder="'-' 없이 숫자만 입력 (11자리)" required maxlength="11"
                           th:errorclass="error-kitsch"/>
                    <span class="field-error" th:if="${#fields.hasErrors('phoneNumber')}"
                          th:errors="*{phoneNumber}"></span>
                </div>

                <div class="form-group-kitsch">
                    <label class="label-kitsch handwriting-font-kitsch" for="birth">생년월일<span
                            class="required-star">*</span></label>
                    <input class="input-kitsch pixel-font-kitsch" id="birth" type="text" th:field="*{birth}"
                           placeholder="생년월일 8자리 (예: 19900515)" required maxlength="8" th:errorclass="error-kitsch"/>
                    <span class="field-error" th:if="${#fields.hasErrors('birth')}" th:errors="*{birth}"></span>
                </div>

                <button class="btn-kitsch primary-btn-kitsch retro-shadow-kitsch" style="width: 100%; margin-top: 2rem;"
                        type="submit">
                    <i class="fas fa-user-plus"></i> 가입하기
                </button>
            </form>
        </div>
    </div>
</div>

<th:block layout:fragment="page_scripts">
    <script>
        document.querySelectorAll('.agreement-checkbox').forEach(function (checkbox) {
            checkbox.addEventListener('change', function () {
                let allRequiredChecked = true;
                document.querySelectorAll('.agreement-checkbox[required]').forEach(function (reqCheckbox) {
                    if (!reqCheckbox.checked) {
                        allRequiredChecked = false;
                    }
                });
                document.getElementById('agreeAll').checked = allRequiredChecked;
            });
        });

        window.addEventListener('DOMContentLoaded', (event) => {
            let allRequiredCheckedInitially = true;
            document.querySelectorAll('.agreement-checkbox[required]').forEach(function (reqCheckbox) {
                if (!reqCheckbox.checked) {
                    allRequiredCheckedInitially = false;
                }
            });
            // document.getElementById('agreeAll').checked = allRequiredCheckedInitially;

            const passwordInput = document.getElementById('password');
            const passwordConfirmInput = document.getElementById('passwordConfirm');
            const form = document.querySelector('form[th\\:action="@{/signup}"]');

            if (form && passwordInput && passwordConfirmInput) {
                form.addEventListener('submit', function (event) {
                    if (passwordInput.value !== passwordConfirmInput.value) {
                        alert('비밀번호와 비밀번호 확인이 일치하지 않습니다.');
                        passwordConfirmInput.focus();
                        event.preventDefault();
                    }
                });
            }
        });
    </script>
</th:block>

</body>
</html>